<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Crafter</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Press Start 2P', cursive; background-color: #87CEEB; }
        .grid-cell { width: 50px; height: 50px; border: 1px solid black; display: flex; align-items: center; justify-content: center; background-color: white; text-align: center; }
        .item-list { max-height: 300px; overflow-y: auto; }
        .item-img { width: 40px; height: 40px; }
        .recipe-list { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px; }
        .recipe-item { width: 100px; text-align: center; }
        .dependency-list { margin-top: 20px; }
        .grid-container { width: 150px; }
    </style>
</head>
<body>
    <header class="bg-green-800 shadow p-4 text-white text-center text-2xl">Minecraft Crafter</header>
    <main class="container mx-auto p-4">
        <input type="text" id="search" placeholder="Buscar ítem..." class="w-full p-2 mb-4 border rounded">
        <div class="item-list border p-2 mb-4 grid grid-cols-10 gap-2"></div> <!-- Lista de ítems con 10 columnas -->
        <div class="flex">
            <div class="grid-container mr-4">
                <div class="grid grid-cols-3 gap-2 mb-4" id="crafting-grid">
                    <div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div>
                    <div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div>
                    <div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div>
                </div>
            </div>
            <div class="dependency-list w-1/3 pl-4">
                <h3 class="text-xl mb-4">Ítems que requieren el ítem seleccionado:</h3>
                <div id="dependency-items" class="grid grid-cols-3 gap-2"></div> <!-- Lista de ítems dependientes con 3 columnas -->
            </div>
        </div>
        <div class="recipe-list" id="craftable-items"></div>
    </main>

    <script>
        let blocks = {};
        let recipes = {};

        async function loadJSON() {
            blocks = await fetch('block.json').then(res => res.json());
            recipes = await fetch('recipe.json').then(res => res.json());
            renderItemList();
        }

        function renderItemList(filter = '') {
    const itemList = document.querySelector('.item-list');
    itemList.innerHTML = '';
    blocks.forEach(item => {
        // Filtramos los ítems que coincidan con la palabra clave
        if (item.name.toLowerCase().includes(filter.toLowerCase())) {
            const div = document.createElement('div');
            div.className = 'p-2 cursor-pointer hover:bg-gray-200 flex items-center';
            div.onclick = () => displayRecipe(item.id);
            
            const img = document.createElement('img');
            img.src = `assets/${item.name}.png`;
            img.alt = item.displayName;
            img.className = 'item-img mr-2';
            img.onerror = () => {
                img.style.display = 'none';
                const text = document.createElement('span');
                text.textContent = item.displayName;
                div.appendChild(text);
            };
            
            div.appendChild(img);
            itemList.appendChild(div);
        }
    });
}

        function displayRecipe(itemId) {
            const gridCells = document.querySelectorAll('.grid-cell');
            gridCells.forEach(cell => cell.innerHTML = '');
            document.getElementById('craftable-items').innerHTML = '';
            document.getElementById('dependency-items').innerHTML = '';

            if (!recipes[itemId]) return;
            const recipe = recipes[itemId][0];
            if (recipe.inShape) {
                recipe.inShape.forEach((row, rowIndex) => {
                    row.forEach((cell, colIndex) => {
                        const index = rowIndex * 3 + colIndex;
                        const block = blocks.find(b => b.id === cell);
                        if (block) {
                            const img = document.createElement('img');
                            img.src = `assets/${block.name}.png`;
                            img.alt = block.displayName;
                            img.className = 'item-img';
                            img.onerror = () => {
                                img.style.display = 'none';
                                const text = document.createElement('span');
                                text.textContent = block.displayName;
                                gridCells[index].appendChild(text);
                            };
                            gridCells[index].appendChild(img);
                        }
                    });
                });
            }
            
            showCraftableItems(itemId);
            showDependencies(itemId);
        }

        function showCraftableItems(itemId) {
            const craftableItemsContainer = document.getElementById('craftable-items');
            blocks.forEach(block => {
                recipes[block.id]?.forEach(recipe => {
                    if (recipe.result === itemId) {
                        const recipeItemDiv = document.createElement('div');
                        recipeItemDiv.className = 'recipe-item';
                        
                        const img = document.createElement('img');
                        img.src = `assets/${block.name}.png`;
                        img.alt = block.displayName;
                        img.className = 'item-img';
                        img.onerror = () => {
                            img.style.display = 'none';
                            const text = document.createElement('span');
                            text.textContent = block.displayName;
                            recipeItemDiv.appendChild(text);
                        };
                        recipeItemDiv.appendChild(img);
                        craftableItemsContainer.appendChild(recipeItemDiv);
                    }
                });
            });
        }

        function showDependencies(itemId) {
            const dependencyItemsContainer = document.getElementById('dependency-items');
            const seenItems = new Set(); // Usamos un Set para evitar duplicados

            blocks.forEach(block => {
                recipes[block.id]?.forEach(recipe => {
                    recipe.inShape?.forEach(row => {
                        row.forEach(cell => {
                            if (cell === itemId && !seenItems.has(block.id)) { // Solo agregamos si no está en el Set
                                const dependencyItemDiv = document.createElement('div');
                                dependencyItemDiv.className = 'recipe-item cursor-pointer hover:bg-gray-200 flex items-center';
                                
                                const img = document.createElement('img');
                                img.src = `assets/${block.name}.png`;
                                img.alt = block.displayName;
                                img.className = 'item-img';
                                img.onerror = () => {
                                    img.style.display = 'none';
                                    const text = document.createElement('span');
                                    text.textContent = block.displayName;
                                    dependencyItemDiv.appendChild(text);
                                };

                                // Hacemos que al hacer clic en el item de dependencia se muestre su receta
                                dependencyItemDiv.onclick = () => displayRecipe(block.id);

                                dependencyItemDiv.appendChild(img);
                                dependencyItemsContainer.appendChild(dependencyItemDiv);

                                seenItems.add(block.id); // Marcamos el ítem como agregado
                            }
                        });
                    });
                });
            });
        }

        // Evento de búsqueda
        document.getElementById('search').addEventListener('input', (e) => {
            const searchText = e.target.value.trim(); // Obtenemos el texto de búsqueda
            renderItemList(searchText); // Filtramos la lista de ítems
        });

        loadJSON();
    </script>
</body>
</html>
